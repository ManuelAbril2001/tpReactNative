import React, {Component} from 'react';
import { StyleSheet, Text, TextInput, TouchableOpacity, View } from 'react-native';
import AsyncStorage from '@react-native-async-storage/async-storage';


class App extends Component {
  constructor(){
    super();
    this.state = {
      saludo: '',
      objeto: {
        name: '',
        lastname: ''
      },
      remove_msg: '',
    }
  }

  componentDidMount(){
    this.getStringStorage();
    this.getObjectStorage();
  }

  async storageString (value){
    try {
      await AsyncStorage.setItem('@clave', value)
    } catch (error) {
      console.log(error);
    }
  }

  async getStringStorage(){
    try{
      const value = await AsyncStorage.getItem('@clave')
      if (value !== null){
          this.setState({saludo: value});
      }else{
        console.log('no existe la clave :(');
      }
    }catch(error){
      console.log(error)
    }
  }

  async storageObject(value){
    try {
      const jsonValue = JSON.stringify(value);
      await AsyncStorage.setItem('@miObjeto', jsonValue);
    } catch (error) {
      console.log(error);
    }
  }

  async getObjectStorage(){
    try{
      const value = await AsyncStorage.getItem('@miObjeto');
      if(value !== null){
        const objeto_recuperado = JSON.parse(value);
        this.setState({objeto: {
          name: objeto_recuperado.name,
          lastname: objeto_recuperado.lastname,
        }})
        console.log(objeto_recuperado)
      }else{
        console.log('valor no encontrado :(')
      }
    }catch(error){
      console.log(error)
    }
  }

  async removeItem(key){
    try{
      await AsyncStorage.removeItem(key);
      this.setState({remove_msg: 'Se borro'});
    }catch(error){
      console.log(error);
    }
  }
  

  render(){

  const { saludo, objeto, remove_msg} = this.state;

  return (
    <View style={aestilo.container}>

      {/* <Text style={aestilo.text}>Tarjetas vol2</Text> */}

      <Text style={aestilo.text}> {saludo} </Text>

      <TouchableOpacity style={aestilo.text}
        onPress={() => this.storageString('hola')} 
      >
        <Text style={aestilo.text}> guardar </Text>
      
      </TouchableOpacity> 

      <Text style={aestilo.text}> {objeto.name} {objeto.lastname}</Text>

      <Text style={aestilo.text}></Text>
      <TouchableOpacity style={aestilo.text}
        onPress={() => this.storageObject({name: 'yo', lastname: 'apellido'})} 
      >
        <Text style={aestilo.text}> guardar persona </Text>
      
      </TouchableOpacity> 

      <Text style={aestilo.text}> {remove_msg} </Text>
      <TouchableOpacity style={aestilo.text}
        onPress={() => this.removeItem('@miObjeto')} 
      >
        <Text style={aestilo.text}> limpiar almacenamiento </Text>
      
      </TouchableOpacity> 

      {/* <Tarjetas/>

      <Buscar/> */}

    </View>
  );
}
}

const aestilo = StyleSheet.create({
  container: {
    flex: 1,
    height: 90,
    backgroundColor: 'white',
    alignItems: 'center',
    justifyContent: 'center',
  },
  text: {
    fontSize: 20,
    fontWeight: "bold",
    color: 'black',
  }
});

export default App;